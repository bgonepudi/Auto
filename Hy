# Define file paths
$file1Path = "C:\path\to\file1.txt"
$file2Path = "C:\path\to\file2.txt"
$logFile = "C:\path\to\comparison_log_$(Get-Date -Format 'yyyyMMdd_HHmmss').txt"

# Record the start time
$startTime = Get-Date
Write-Output "Comparison started at: $startTime"

# Read the contents of each file into arrays
$file1Lines = Get-Content -Path $file1Path
$file2Lines = Get-Content -Path $file2Path

# Prepare log output
$logContent = @()
$differencesFound = $false

# Compare each line and segment
for ($i = 0; $i -lt [math]::Max($file1Lines.Length, $file2Lines.Length); $i++) {
    $line1 = if ($i -lt $file1Lines.Length) { $file1Lines[$i] } else { "" }
    $line2 = if ($i -lt $file2Lines.Length) { $file2Lines[$i] } else { "" }

    # Split lines into segments (assuming space as a delimiter, adjust as necessary)
    $segments1 = $line1 -split '\s+'
    $segments2 = $line2 -split '\s+'
    
    # Compare each segment in the line
    for ($j = 0; $j -lt [math]::Max($segments1.Length, $segments2.Length); $j++) {
        $segment1 = if ($j -lt $segments1.Length) { $segments1[$j] } else { "" }
        $segment2 = if ($j -lt $segments2.Length) { $segments2[$j] } else { "" }

        if ($segment1 -ne $segment2) {
            $differencesFound = $true
            # Log difference details with line number, segment number, and file
            $differenceDetails = "Difference found at Line $($i+1), Segment $($j+1):`n" +
                                 "File 1: $segment1`n" +
                                 "File 2: $segment2`n" +
                                 "-------------------------------------------"
            $logContent += $differenceDetails
            Write-Output $differenceDetails  # Output to console
        }
    }
}

# Record the end time and calculate the duration
$endTime = Get-Date
$duration = $endTime - $startTime

# Log overall result
if ($differencesFound) {
    $differenceMessage = "Differences found between files."
} else {
    $differenceMessage = "No differences found between files."
}

# Add summary to the log
$logContent += "Comparison Log - $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')"
$logContent += "Start Time: $startTime"
$logContent += "End Time: $endTime"
$logContent += "Duration: $duration"
$logContent += $differenceMessage

# Save log to file
$logContent | Set-Content -Path $logFile

# Output summary to console
Write-Output $differenceMessage
Write-Output "Log saved to: $logFile"
Write-Output "Start Time: $startTime"
Write-Output "End Time: $endTime"
Write-Output "Duration: $duration"
