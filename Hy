import json
import pprint

def convert_to_nested_structure(flat_data):
    nested_data = {}

    for key, value in flat_data.items():
        keys = key.split('.')
        d = nested_data
        
        for k in keys[:-1]:
            if k.endswith(']'):  # Check for array indices like 'customers[0]'
                k, idx = k[:-1].split('[')
                idx = int(idx)
                if k not in d:
                    d[k] = []
                while len(d[k]) <= idx:
                    d[k].append({})
                d = d[k][idx]
            else:
                if k not in d:
                    d[k] = {}
                d = d[k]

        d[keys[-1]] = value

    return nested_data

# Path to your JSON file
input_file_path = 'C:/path/to/your/data.json'
output_file_path = 'C:/path/to/your/nested_data.json'

# Read the JSON file
with open(input_file_path, 'r') as file:
    data = json.load(file)

# Convert the flat JSON structure to a nested structure
nested_data = convert_to_nested_structure(data)

# Print the nested structure
pprint.pprint(nested_data)

# Save the nested structure back to a new JSON file
with open(output_file_path, 'w') as file:
    json.dump(nested_data, file, indent=4)
