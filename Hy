Sub ListJSONFiles()
    Dim folderPath As String
    Dim fileSystem As Object
    Dim folder As Object
    Dim file As Object
    Dim i As Long
    Dim ws As Worksheet
    Dim rng As Range
    Dim sheetName As String

    sheetName = "JSON Files"

    ' Delete the sheet if it already exists
    On Error Resume Next
    Application.DisplayAlerts = False
    Sheets(sheetName).Delete
    Application.DisplayAlerts = True
    On Error GoTo 0

    ' Get the folder path from cell D15
    folderPath = ThisWorkbook.Sheets("Sheet1").Range("D15").Value
    If Right(folderPath, 1) <> "\" Then folderPath = folderPath & "\"

    ' Create a new sheet
    Sheets.Add(After:=Sheets(Sheets.Count)).Name = sheetName
    Set ws = Sheets(sheetName)

    ' Set up headers
    ws.Cells(1, 1).Value = "File Name"
    ws.Cells(1, 2).Value = "File Path"
    ws.Cells(1, 3).Value = "Convert"

    ' Initialize row counter
    i = 2

    ' Set up file system object
    Set fileSystem = CreateObject("Scripting.FileSystemObject")
    Set folder = fileSystem.GetFolder(folderPath)

    ' Loop through each file in the folder
    For Each file In folder.Files
        If fileSystem.GetExtensionName(file.Name) = "json" Then
            ws.Cells(i, 1).Value = file.Name
            ws.Cells(i, 2).Value = file.Path
            ws.Cells(i, 3).Value = "N" ' Default value
            i = i + 1
        End If
    Next file

    ' Format the "Convert" column
    Set rng = ws.Range("C2:C" & i - 1)
    With rng.Validation
        .Delete ' Remove any existing validation
        .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
            xlBetween, Formula1:="Y,N"
        .IgnoreBlank = True
        .InCellDropdown = True
        .ShowInput = True
        .ShowError = True
    End With

    ' Apply conditional formatting
    With rng.FormatConditions
        .Delete ' Remove any existing conditional formatting
        ' Add conditional format for "Y"
        .Add Type:=xlCellValue, Operator:=xlEqual, Formula1:="=""Y"""
        With .Item(.Count).Interior
            .PatternColorIndex = xlAutomatic
            .Color = 5296274 ' Green color
            .TintAndShade = 0
        End With
        ' Add conditional format for "N"
        .Add Type:=xlCellValue, Operator:=xlEqual, Formula1:="=""N"""
        With .Item(.Count).Interior
            .PatternColorIndex = xlAutomatic
            .Color = 65535 ' Yellow color
            .TintAndShade = 0
        End With
    End With

    MsgBox "JSON file list generated successfully!", vbInformation
End Sub
