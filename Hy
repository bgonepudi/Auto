# Load the CSV file content
$csvFilePath = "path_to_your_csv_file.csv"
$csvContent = Import-Csv -Path $csvFilePath

# Create an array to hold the final JSON objects
$jsonArray = @()

# Iterate through each row in the CSV
foreach ($row in $csvContent) {
    # Create a new custom object for each row
    $jsonObject = [PSCustomObject]@{}

    # Iterate through each property (column) in the row
    foreach ($column in $row.PSObject.Properties) {
        if ($column.Name -match "^(.*?)\.(.+)$") {
            $prefix = $matches[1]
            $subKey = $matches[2]

            # Initialize the nested structure if it doesn't exist
            if (-not $jsonObject.PSObject.Properties.Match($prefix)) {
                $jsonObject | Add-Member -MemberType NoteProperty -Name $prefix -Value ([PSCustomObject]@{})
            }

            # Add the subKey and its value to the nested structure
            $jsonObject.$prefix | Add-Member -MemberType NoteProperty -Name $subKey -Value $column.Value
        } else {
            # If the column doesn't have a dot, add it directly to the main object
            $jsonObject | Add-Member -MemberType NoteProperty -Name $column.Name -Value $column.Value
        }
    }

    # Add the processed object to the array
    $jsonArray += $jsonObject
}

# Convert the array to JSON
$jsonOutput = $jsonArray | ConvertTo-Json -Depth 10

# Save the JSON output to a file
$jsonFilePath = "path_to_save_json_file.json"
$jsonOutput | Set-Content -Path $jsonFilePath
