# Define the list of VMs
$vmList = @(
    "VM1_IP_or_Hostname",
    "VM2_IP_or_Hostname",
    "VM3_IP_or_Hostname"
    # Add more VMs as needed
)

# Common username
$username = "YourUsername"

# Retrieve the stored password
$password = Get-Content "C:\Path\To\password.txt" | ConvertTo-SecureString
$credentials = New-Object System.Management.Automation.PSCredential ($username, $password)

foreach ($vm in $vmList) {
    # Create a temporary RDP file for each VM
    $rdpFile = "$env:TEMP\$vm.rdp"
    New-Item -Path $rdpFile -ItemType File -Force | Out-Null

    # Populate the RDP file with the necessary details
    Add-Content $rdpFile "full address:s:$vm"
    Add-Content $rdpFile "username:s:$username"
    Add-Content $rdpFile "password 51:b:$([System.Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes($password)))"

    # Start the Remote Desktop session using the RDP file
    Start-Process "mstsc.exe" -ArgumentList $rdpFile

    # Wait for 2 minutes (120 seconds)
    Start-Sleep -Seconds 120

    # Remove the temporary RDP file
    Remove-Item $rdpFile
}

Write-Host "Remote Desktop sessions initiated for all VMs."
